{% load custom_tags %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HOME</title>
     
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>-->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

</head>

<body>
    <nav class="navbar navbar-expand-md bg-light navbar-light border-bottom">
        <a class="navbar-brand">{{ score.candidate.sholarship }}&nbsp;{{ user }}&nbsp;님이 입력한 점수표</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
          <span class="navbar-toggler-icon"></span>
        </button>
       
      </nav>
      <br>
      <div class="container my-3">
      <p style="color:green;">입력 상태:Total Entered/Total Requird<strong> {{ total_entered }} / {{ total_required }}</strong></p>
      
        
        {% if grouped_scores %}
        <table class="table table-bordered">
          <tr>
            <th>후보자</th>
            <th>기준</th>
            <th>점수</th>
            <th>수정</th>
          </tr>
        
          {% for candidate, scores in grouped_scores.items %}
            {% for score in scores %}
              <tr>
                {% if forloop.first %}
                  <td rowspan="{{ scores|length|add:1 }}">{{ candidate.name }}</td>
                {% endif %}
                <td>{{ score.criteria.name }}</td>
                <td>{{ score.score }}</td>
                <td><a href="{% url 'edit_score' score.id %}" class="btn btn-secondary">수정</a></td>
              </tr>
            {% endfor %}
            <tr>
              <td><strong>총점</strong></td>
              <td colspan="2">
                <strong>{{ candidate_totals|get_item:candidate.id }}</strong>
                
                {% with total=candidate_totals|get_item:candidate.id %}
                  {% if total < 20 %}
                    <span style="color: red;">⚠ 총점이 너무 낮습니다.</span>
                  {% elif total > 100 %}
                    <span style="color: red;">⚠ 총점이 너무 높습니다.</span>
                  {% else %}
                    <span style="color: green;">⚠ 총점이 100점 아래 20점 이상으로 유효합니다. 선정기준별로 초과하거나 미달된 점수가 입력되지 않았는지 확인바랍니다. </span>
                  {% endif %}
                {% endwith %}
              </td>
            </tr>
          {% endfor %}
        </table>
        {% else %}
          <p>입력된 점수가 없습니다.</p>
        {% endif %}

        {% if total_required == total_entered %}
        <p style="color:green;"><strong>✅ 모든 점수를 입력 완료하셨습니다! [완료] 버튼을 눌러 주세요 </strong></p>

      {% endif %}

        <a href="{% url 'index' %}" class="btn btn-secondary">홈으로</a>
        <a href="{% url 'mark_review_complete' %}" class="btn btn-secondary">완료</a>
</body>
</html>